<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="../css/mainstyle.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div id="sidebar-container"></div>
    <main class="main-content">
        <h1>Poules</h1>

        <div class="toolbar">
            <button class="toolbar-button" style="font-size: 2rem;">
                +
            </button>
        </div>

        <div style="width: 100%;height: 100%;margin-top: 1rem;display: flex;flex-direction: row;">
            <div style="background-color: red;width: 20%;min-width: 300px;flex-direction: column;gap: 5px;display: flex;">
                <div style="background-color: yellow;width: 100%;display: flex;align-items: center;justify-content: space-between;padding: 0 5px;">
                    <div style="background-color: blue;height: 25px;width: 25px;cursor: pointer;" class="dragger"></div>
                    <p style="font-size: 17.5px;user-select: none;">Tristan Koning</p>
                </div>
            </div>
            <div id="poule-entries" style="background-color: green;flex: 1;display: flex;padding: 2.5rem;box-sizing: border-box;flex-wrap: wrap;justify-content: center;align-items: baseline;gap: 2rem;">
            </div>
        </div>
    </main>

    <template id="poule-template" style="background-color: blue;width: 300px;padding: 1rem;">
        <p style="text-align: center;font-size: 20px;" for="naam">poule naam (0/4)</p>
        <div style="display: flex;flex-direction: column;gap: .5rem;margin-top: 10px;" for="entry-list">
        </div>
    </template>

    <template id="open-entry-template">
        <div style="border: 2.5px dashed pink;height: 25px;align-items: center;display: flex;"></div>
    </template>

    <template id="consumed-entry-template">
        <div style="background-color: pink;height: 25px;align-items: center;display: flex;padding: 0 4px;gap: 5px;">
            <div style="background-color: red;width: 25px;height: 25px;cursor: pointer;" for="btn-remove"></div>
            <p for="naam"></p>
        </div>
    </template>

    <script src="header.js"></script>
</body>

</html>

<script>
    let draggingElement = null;
    let inschrijving = [];
    let poules = [];
    let elems = document.getElementsByClassName('dragger');

    (async() => {
        const openEntryTemplate = document.getElementById('open-entry-template');
        const consumedEntryTemplate = document.getElementById('consumed-entry-template');

        addEventListener('mouseup', dragRelease);
        addEventListener('mousemove', mouseMove);
        for(let element of elems) {
            element.addEventListener('mousedown', dragBegin);
        }
        
        const pouleEntriesElement = document.getElementById('poule-entries');
        const pouleTemplate = document.getElementById('poule-template');

        inschrijvingen = await (await fetch('/adminpanel/rest.php?path=inschrijvingen')).json();
        poules = await (await fetch('/adminpanel/rest.php?path=poules')).json();

        createPoules();

        function createPoules() {
            pouleEntriesElement.innerHTML = '';  

            for(let poule of poules) {
                createPoule(poule);
            }
        }

        function createPoule(poule) {
            const members = JSON.parse(poule.members);


            let entryElem = document.createElement('div');
            const content = pouleTemplate.content.cloneNode(true);
            entryElem.style = pouleTemplate.getAttribute('style');
            content.querySelector('[for="naam"]').textContent = `${poule.naam} (${members.length}/4)`;
            const entryList = content.querySelector('[for="entry-list"');

            for(let i = 0; i < 4; i++) {
                if(members[i]) {
                    const elem = consumedEntryTemplate.content.cloneNode(true);
                    const inschrijving = inschrijvingen.find(x => parseInt(x.id) === members[i]);
                    elem.querySelector('[for="naam"]').textContent = `${inschrijving.naam} ${inschrijving.achternaam}`;
                    elem.querySelector('[for="btn-remove"]').addEventListener('click', click => {
                        poule.members = JSON.stringify(JSON.parse(poule.members).filter(x => parseInt(x) !== parseInt(inschrijving.id)));
                        createPoules();
                    });
                    const instance = entryList.appendChild(elem);
                } else entryList.appendChild(openEntryTemplate.content.cloneNode(true));
            }

            entryElem.append(content);
            pouleEntriesElement.append(entryElem);
        }
    })();

    function dragBegin(event) {
        document.body.style.userSelect = 'none';

        draggingElement = event.target.parentNode;
        draggingElement.style.width = draggingElement.offsetWidth + 'px';
        draggingElement.style.height = draggingElement.offsetHeight + 'px';
        draggingElement.style.left = draggingElement.offsetLeft + 'px';
        draggingElement.style.top = draggingElement.offsetTop + 'px';
        draggingElement.style.zIndex = '10000';

        draggingElement.style.position = 'absolute';
    }

    function dragRelease(event) {
        if(!draggingElement)
            return;

        document.body.style.userSelect = null;

        lastMove = [];
        draggingElement.style.position = 'relative';

        draggingElement.style.width = null;
        draggingElement.style.height = null;

        draggingElement.style.top = null;
        draggingElement.style.left = null;
        draggingElement.style.zIndex = null;

        draggingElement = null;
    }

    let lastMove = [];

    function mouseMove(event) {
        if(!draggingElement)
            return;
        let delta = [event.movementX, event.movementY];

        let currX = parseInt(draggingElement.style.left);
        if(currX !== currX)
            currX = 0;
        let currY = parseInt(draggingElement.style.top);
        if(currY !== currY)
            currY = 0;

        draggingElement.style.left = (currX + delta[0]) + 'px';
        draggingElement.style.top = (currY + delta[1]) + 'px';
    }
</script>

<style>
    .toolbar {
        width: 100%;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 1rem;
    }

    .toolbar-button {
        background-color: #EC644A;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .toolbar-button:hover {
        border: 1px solid var(#00555C);
        box-shadow: 1px 4px 15px rgba(0, 0, 0, 0.32);
        filter: brightness(.9);
    }

    @keyframes hover {
        0% {
            filter: opacity(1);
            border-color: red;
        }
        50% {
            filter: opacity(.2);
        }
        100% {
            filter: opacity(1);

            border-color: red;
        }
    }
</style>
