<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="../css/mainstyle.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div id="sidebar-container"></div>
    <main class="main-content">
        <h1>Inschrijvingen</h1>

        <div id="entries" style="display: flex;flex-direction: column;">

        </div>
    </main>

    <template id="entry-template">
        <!-- <h2>Naam</h2>
        <span d-link="naam" style="color: red;"></span>
        <h2>Achternaam</h2>
        <span d-link="achternaam" style="color: green;"></span>
        <h2>Email</h2>
        <span d-link="email" style="color: blue;"></span> -->

        <span d-variables="email,naam,achternaam,id">mijn email is %s en mijn naam is %s %s. Mijn ID is %</span>
    </template>

    <script src="header.js"></script>
    <script>
        const templateElem = document.querySelector('template[id="entry-template"]');
        const entriesElem = document.querySelector('div[id="entries"]');

        (async() => {
            const entries = await (await fetch('rest.php?path=inschrijvingen')).json();
            for(let entry of entries)
            {
                let entryElem = document.createElement('div');
                const content = templateElem.content.cloneNode(true);
                
                for(let item of Array.from(content.querySelectorAll('*')).filter(x => x.hasAttribute('d-variables'))) {
                    let queue = [];
                    
                    for(let variable of item.getAttribute('d-variables').split(','))
                        queue.push(entry[variable]);

                    let output = '';
                    let formating = false

                    let queueIndex = 0;
                    let i = 0;
                    while(i < item.textContent.length) {
                        try {
                            const character = item.textContent[i];
                            if(character === '%') {
                                formating = true;
                                continue;
                            }
                            
                            if(formating) {
                                formating = false;
                                const data = queue[queueIndex++];
                                switch(character) {
                                    case 's':
                                        output += String(data);
                                        break;
                                    case 'i':
                                        output += parseInt(data);
                                        break;
                                    case 'f':
                                        output += parseFloat(data).toFixed(2);
                                        break;
                                }
                            } else output += character;
                        }
                        finally {
                            i++;
                        }
                    }

                    item.textContent = output;
                }

                entryElem.append(content);
                entriesElem.append(entryElem);
            }
        })();
    </script>
</body>
</html>